# IoTの全体像

## 概要

IoT(Internet of Things)とは、さまざまなモノ(デバイス)がインターネットにつながり、データをやり取りすることで新しいサービスや価値を生み出すコンセプトです。IoTの全体像は、ネットワーク、デバイス、アプリケーションの3つの要素から構成されています。

## 要素間の関係性

<img src="https://i.gyazo.com/6efed8819c6ec78a1c9463b3f64aa881.png" />


### ネットワーク

IoTシステムでは、モノ（デバイス）とアプリケーションを接続するネットワークが不可欠です。デバイスからのデータは、有線または無線のネットワークを経由してクラウドに送信されます。

### デバイス

デバイスは、みなさんが使っているiPadやスマートフォンのようなものから、センサーやアクチュエータまでさまざまなものがあります。デバイスは、周囲の環境データを収集したり、アプリケーションからの命令に応じて動作したりします。収集したデータはネットワークを介してアプリケーションに送信されます。

### アプリケーション

IoTシステムの中核を担います。アプリケーションは、デバイスからのデータを収集・蓄積し、機械学習などによってデータ分析を行います。分析結果に基づいて、デバイスへの制御命令を送信したり、ユーザーインターフェースを提供したりします。


ネットワーク、デバイス、アプリケーションが連携することでIoTシステムが機能します。

これらの要素が適切に設計・構築されることで、新しいサービスやソリューションが実現できます。




# ネットワークについてもうすこし深堀り

図

1. LAN: 限られた地理的範囲内でコンピューターやネットワーク機器が接続されているネットワークです。一般的には、オフィス、学校、家庭などの建物内で使用されます。

2. WAN: 広い地理的範囲をカバーするネットワークで、複数のLANを接続できます。インターネットや企業のグローバルネットワークなどがこれに該当します。


3. インターネット: 世界中のコンピューターやネットワークが相互に接続された大規模なグローバルネットワークです。WANの一形態。



## 機器をネットワークにつなぐための無線通信規格


### Wi-Fi（Wireless Local Area Network）
おなじみの、無線でインターネットやネットワークに接続するための技術です。
Wi-Fiルーターを通じて複数のデバイスがインターネットに接続できます。

### LTE (Long Term Evolution)
高速なモバイル通信技術の1つで、携帯電話やタブレットなどのモバイルデバイスによるデータ通信にも使用されます。
大きなデータを速く送受信できるため動画ストリーミングやオンラインゲームなどにも適しています。

### LPWA (Low Power Wide Area)  
Wi-FiやLTEと比較して、**低消費電力で広範囲**をカバーできる無線通信技術の総称です。
センサーデバイスやスマートメーターなどのIoTデバイスを大量に接続したい場合に適しています。


## 機器同士をつなぐのによく使われる通信規格

### シリアル通信
データを送受信するための信号線を1本（または2本）使用して、データを1ビットずつ送受信する通信方式。 
USBやHDMIは、シリアル通信の一種です。

### Bluetooth
10m程度の短距離の無線通信規格。
スマートフォンにイヤフォンやスピーカーを繋いで使う時など、馴染み深い技術ではないでしょうか？



## 通信プロトコル

通信プロトコル = データをやりとりするために定められた手順や規約、信号の電気的規則、通信における送受信の手順などを定めた規格のこと。

いろいろな目的のために、さまざまな通信プロトコルが存在します。



### TCP/IP（Transmission Control Protocol/Internet Protocol）

ケーブルや電波などを使ってデータを送信するために文書も画像もすべてのデータを電気信号や光信号に変換をする必要があります。
そして、受け取る側は、受け取った信号を再び元の文書や画像に戻さなければなりません。

どのように信号に変換し、伝達し、データへの再変換を行うか？という一連の流れを統一した手続きに基づいて行うTCP/IPという仕組みが生まれました。

TCP/IPという共通の仕組みで世界中のネットワークを繋いでいるのがインターネットです。

### 5つの階層に分かれるTCP/IPの構造 

図を入れる



アプリケーション層は、コンピューター同士のやりとりをユーザーが利用できる「通信サービス」という形にする役割です。

アプリケーションに合わせた通信を行うため、さまざまなプロトコルがあります。

このクラスですでに使っているものやIoTでよく利用されるものがありますのでいくつか紹介をします。


#### HTTP (HyperText Transfer Protocol)
SNSを閲覧するときや投稿する時、そのたびにHTTP通信が行われています。

図を入れる

スマートフォンなどのWebクライアントから**リクエストがあったときだけ、Webサーバーがデータを返します**。

「データちょうだいよ」って言わないと、くれないのがHTTPです。



#### **WebSocket**
HTTPとは異なり、リアルタイムのデータ送受信を可能にするプロトコルです。
最初に一度接続を確立すると、切断するまでずっと情報のやりとりを行います。
チャットやオンラインゲームで利用されることが多いです。

図を入れる

obnizはWi-Fiに接続し、WebSocketによりリアルタイムなデータ送受信を可能にしています。


#### **MQTT (Message Queuing Telemetry Transport)**
軽量なデータを大量に送信することに向いている、IoTでよく利用されるプロトコルです。

WebSocketでは、サーバーとクライアントの接続を確立したうえでリアルタイムなデータの送受信を行いますが
MQTTの場合は直接接続を確立するのでなくブローカーを介してやりとりを行います。

本屋さんにたとえて説明してみます。


本屋さん（MQTTブローカー）
作家のハルキさん（パブリッシュ: データを送る）
購読者のヨミツグさん（サブスクライブ: データを読む）
ハルキさんの棚（トピック）


図を入れる


- ハルキさんは、購読者がいようといまいと、本屋さんにある自分の棚に新作を出し続けます。
- ヨミツグさんは、新作が出ようと出まいと、山田さんの棚を毎日見に行きます
- ハルキさん以外の作家さんが、30人に増えました。でもMQTTなら、大丈夫。ハルキさんの作品しか興味がないヨミツグさんはハルキさんの棚だけ見に行くことができます。
- ハルキさんのファン（購読者）が10000人に増えました。でもMQTTなら、大丈夫。

WebScoketの場合は...

まとめるとMQTTは
- 送信側と受信側で接続を確立する必要がない
- 軽量なデータを頻繁に送るのに適している
- パブリッシャー（作家）とサブスクライバー（購読者）がたくさん増えても大丈夫。購読者は必要な情報だけ取りに行くことができる。


## 考えてみよう


### 1. お家に設置した太陽光発電システムの発電量をリアルタイムに取得しスマートフォンから見られるようにする

回答 ※ 正解ということではなく、あくまでも1つの例です
- 電源: コンセントからとる
- ネットワーク: 家のWi-Fiに接続
発電量を取得してMQTTブローカーにパブリッシュし、スマートフォン側からそのデータをサブスクライブする。



### 2. キャッシュレス決済付きの自販機をつくるとき、どんな通信規格をつかう...？

回答 ※ 正解ということではなく、あくまでも1つの例です
- 電源: コンセントからとる
- ネットワーク: LTEかLPWA
決済時、スマートフォンでタッチ→ HTTPでペイメントシステムにリクエスト→ 決済が成功したレスポンスが返ってくる→ 飲み物が出る



