# IoTの全体像

## 概要

IoT(Internet of Things)とは、様々なモノ(デバイス)がインターネットにつながり、データをやり取りすることで新しいサービスや価値を生み出すコンセプトです。IoTの全体像は、ネットワーク、デバイス、アプリケーションの3つの要素から構成されています。

## 要素間の関係性

<img src="https://i.gyazo.com/6efed8819c6ec78a1c9463b3f64aa881.png" />


### ネットワーク

IoTシステムでは、デバイスとアプリケーション(クラウド)を接続するネットワークが不可欠です。デバイスからのデータは、有線または無線のネットワークを経由してクラウドに送信されます。ネットワークには、インターネット、Wi-Fi、LTE、LPWA(LoRaWAN、SigFox、NB-IoTなど)などの技術が利用されます。

### デバイス

デバイスは、センサーやアクチュエータなどのIoTエッジデバイスを指します。デバイスは、周囲の環境データを収集したり、クラウドからの命令に応じて動作したりします。収集したデータはネットワークを介してクラウドに送信されます。

### アプリケーション

クラウド上で動作するアプリケーションが、IoTシステムの中核を担います。アプリケーションは、デバイスからのデータを収集・蓄積し、機械学習などによってデータ分析を行います。分析結果に基づいて、デバイスへの制御命令を送信したり、ユーザーインターフェースを提供したりします。

## 全体像のまとめ

IoTの全体像は、以下のようなデータフローで表すことができます。

1. デバイスが環境データを収集
2. デバイスからデータをネットワークを介してクラウドに送信
3. クラウド上のアプリケーションでデータを処理・分析
4. 分析結果に基づいてデバイスへ制御命令を送信
5. デバイスが制御命令にしたがって動作

このように、ネットワーク、デバイス、アプリケーションが有機的に連携することで、IoTシステムが機能します。これらの要素が適切に設計・構築されることで、新しいサービスやソリューションが実現できます。

必要な知識が多岐にわたり、IT界隈における総合格闘技と言われています。

# ネットワークについて

## ネットワークプロトコル

### TCP/IP
- ネットワーク層(IPプロトコル)とトランスポート層(TCPプロトコル)で構成される通信プロトコル群
- インターネットの基盤技術で、IPがデータの宛先を指定し、TCPが信頼性の高い通信を行う
- HTTP、MQTT、WebSocketなどの上位プロトコルがTCP/IP上で動作する

#### HTTP (HyperText Transfer Protocol)
- TCP/IPの上で動作するアプリケーション層のプロトコル 
- Webブラウザとサーバー間の通信に使われ、リソース(HTMLなど)の要求と応答を行う

#### **MQTT (Message Queuing Telemetry Transport)**
- TCP/IPの上で動作する発行・購読型のメッセージングプロトコル
- IoTデバイス間の軽量な通信に適している

#### **WebSocket**
- TCP/IPの上で動作する全二重通信プロトコル
- リアルタイムなデータ交換に適しており、Webアプリケーションでよく使われる

## 無線通信規格

### Wi-Fi
- Wi-Fiは無線LAN(Local Area Network)の技術標準
- 通信範囲は条件によって異なるが、一般的には室内で30〜100mくらい
- 電波が届く範囲内であれば自由に移動しながらインターネットに接続できる

### LTE (Long Term Evolution)
- 携帯電話ネットワークの高速無線通信規格
- TCP/IPベースの通信を無線でサポートする

### LPWA (Low Power Wide Area)  
- Wi-FiやLTEと比較して、**低消費電力**で広範囲をカバーできる無線通信技衎の総称

## その他の通信方式

### シリアル通信
- 2つのデバイスを物理的に接続して、1対1でデータを送受信する手段
- TCP/IPとは別の通信方式だが、TCP/IPを使ったシリアル通信も可能

### Bluetooth
- 近距離無線通信の規格
- デバイス間でデータの送受信を行う。TCP/IPとは異なる通信規格



obnizはWi-Fiに接続し、WebSocketによりリアルタイムなデータ送受信を可能にしています。Bluetoothも利用ができます。




### MQTTで大切な4つの用語
- MQTTブローカー:
MQTTブローカーは、クライアント間のメッセージングを仲介するサーバーです。ブローカーはメッセージを受け取り、サブスクライバーにメッセージを転送します。また、パブリッシャーから受け取ったメッセージを適切なサブスクライバーに送信します。ブローカーは通常、パブリッシュ/サブスクライブのトラフィックを管理し、セキュリティや認証などの機能も提供します。

- トピック:
トピックは、メッセージがパブリッシュされたりサブスクライブされたりする場所を識別するための識別子です。例えば、"home/temperature"や"sensor/data"のようなものです。トピックは階層的な構造を持つことができ、ワイルドカードを使って複数のトピックを一度に指定することもできます。

- Publish (パブリッシュ):
パブリッシュは、メッセージをブローカーに送信する操作です。クライアントが特定のトピックにメッセージを送信すると、ブローカーはそのメッセージを受け取り、適切なサブスクライバーに送信します。

- Subscribe (サブスクライブ):
サブスクライブは、特定のトピックに対するメッセージを受信するための操作です。クライアントはブローカーに対して特定のトピックに対してサブスクライブすることで、そのトピックに関連するメッセージを受信できます。


## 目標
今回は、Node-RED上にMQTTブローカーを立てて、MQTTによるデータ通信の体験する

## やってみよう
### 温湿度センサーの値をGUIにリアルタイムに表示してみよう


## MQTT使わなくてもobnizだけでやりたいことできてない...？というギモンについて

obnizはWebsocketという通信プロトコルを採用し、リアルタイムなデータのやり取りを実現しています。

WebSocketは、双方向の通信を可能にするプロトコルで、主な目的はWebブラウザとサーバー間でのリアルタイムな双方向通信を実現することです。たとえば、チャットアプリケーションやオンラインゲームで利用されます。

https://mosquitto.org/