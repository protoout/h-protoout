# IoTの全体像

## 概要

IoT(Internet of Things)とは、さまざまなモノ(デバイス)がインターネットにつながり、データをやり取りすることで新しいサービスや価値を生み出すコンセプトです。IoTの全体像は、ネットワーク、デバイス、アプリケーションの3つの要素から構成されています。

## 要素間の関係性

<img src="https://i.gyazo.com/f75b33b37a850dd08b6579c234cbd179.png" />


### ネットワーク

IoTシステムでは、モノ（デバイス）とアプリケーションを接続するネットワークが不可欠です。デバイスからのデータは、有線または無線のネットワークを経由してクラウドに送信されます。

### モノ（デバイス）

デバイスは、みなさんが使っているiPadやスマートフォンのようなものから、センサーやアクチュエータまでさまざまなものがあります。デバイスは、周囲の環境データを収集したり、アプリケーションからの命令に応じて動作したりします。収集したデータはネットワークを介してアプリケーションに送信されます。

### クラウド上のアプリケーション

IoTシステムの中核を担います。クラウド上にあるアプリケーションは、デバイスからのデータを収集・蓄積し、機械学習などによってデータ分析を行います。分析結果に基づいて、デバイスへの制御命令を送信したり、ユーザーインターフェースを提供したりします。


ネットワーク、モノ（デバイス）、クラウド上にあるアプリケーションが連携することでIoTシステムが機能します。

これらの要素が適切に設計・構築されることで、新しいサービスやソリューションが実現できます。




# ネットワークについてもうすこし深堀り

図

1. LAN: 限られた地理的範囲内でコンピューターやネットワーク機器が接続されているネットワークです。一般的には、オフィス、学校、家庭などの建物内で使用されます。

2. WAN: 広い地理的範囲をカバーするネットワークで、複数のLANを接続できます。インターネットや企業のグローバルネットワークなどがこれに該当します。インターネットはWANの一形態。



## 機器をネットワークにつなぐための無線通信規格


### Wi-Fi（Wireless Local Area Network）
おなじみの、無線でインターネットやネットワークに接続するための技術です。
Wi-Fiルーターを通じて複数のデバイスがインターネットに接続できます。

### LTE (Long Term Evolution)
高速なモバイル通信技術の1つで、携帯電話やタブレットなどのモバイルデバイスによるデータ通信にも使用されます。
大きなデータを速く送受信できるため動画ストリーミングやオンラインゲームなどにも適しています。

### LPWA (Low Power Wide Area)  
Wi-FiやLTEと比較して、**低消費電力で広範囲**をカバーできる無線通信技術の総称です。
センサーデバイスやスマートメーターなどのIoTデバイスを大量に接続したい場合に適しています。

### Bluetooth
10m程度の短距離の無線通信規格。
スマートフォンにイヤフォンやスピーカーを繋いで使う時など、馴染み深い技術ではないでしょうか？


## 有線の通信

LANケーブル、USB（Universal Serial Bus）、電話回線、HDMI（High-Definition Multimedia Interface）



## 通信プロトコル

通信プロトコル = データをやりとりするために定められた手順や規約、信号の電気的規則、通信における送受信の手順などを定めた規格のこと。

いろいろな目的のために、さまざまな通信プロトコルが存在します。



### TCP/IP（Transmission Control Protocol/Internet Protocol）

ケーブルや電波などを使ってデータを送信するために文書も画像もすべてのデータを電気信号や光信号に変換をする必要があります。
そして、受け取る側は、受け取った信号を再び元の文書や画像に戻さなければなりません。

どのように信号に変換し、伝達し、データへの再変換を行うか？という一連の流れを統一した手続きに基づいて行うTCP/IPという仕組みが生まれました。

TCP/IPという共通の仕組みで世界中のネットワークを繋いでいるのがインターネットです。

### 5つの階層に分かれるTCP/IPの構造 

<img src= "https://i.gyazo.com/90e20bb6a7b8074cc81b34beb7a60793.png" width="500">


アプリケーション層は、コンピューター同士のやりとりをユーザーが利用できる「通信サービス」という形にする役割です。

アプリケーションに合わせた通信を行うため、さまざまなプロトコルがあります。

このクラスですでに使っているものやIoTでよく利用されるものがありますのでいくつか紹介をします。




#### HTTP (HyperText Transfer Protocol)



SNSを閲覧するときや投稿する時、そのたびにHTTP通信が行われています。

図を入れる

「データちょうだいよ」、っていうと、サーバーが情報を返してくれます。

1台のサーバと複数台のクライアントを接続し、スマートフォンなどのWebクライアントから**リクエストがあったときだけ、Webサーバーがレスポンスを返します**。





#### **WebSocket**

HTTPとは異なり、1台のサーバと複数台のクライアントによる**リアルタイムな双方向通信**を行うためのです。
最初に一度接続を確立すると、切断するまでずっと情報のやりとりを行います。
チャットやオンラインゲームで利用されることが多いです。

図を入れる

obnizはWi-Fiに接続し、WebSocketによりリアルタイムなデータ送受信を可能にしています。




#### **MQTT (Message Queuing Telemetry Transport)**
軽量なデータを大量に送信することに向いている、IoTでよく利用されるプロトコルです。

WebSocketでは、サーバーとクライアントの接続を確立したうえでリアルタイムなデータの送受信を行いますが
MQTTの場合は複数台のクライアントがブローカーを介して送受信を行います。

本屋さんにたとえて説明してみます。


本屋さん（MQTTブローカー）
作家のハルキさん（パブリッシュ: データを送る）
購読者のヨミツグさん（サブスクライブ: データを読む）
ハルキさんの棚（トピック）


図を入れる


- ハルキさんは、購読者がいようといまいと、本屋さんにある自分の棚に新作を出し続けます。
- ヨミツグさんは、新作が出ようと出まいと、ハルキさんの棚を毎日見に行きます
- ハルキさん以外の作家さんの棚が30個増えました。でもMQTTなら、大丈夫。ハルキさんの作品しか興味がないヨミツグさんはハルキさんの棚だけ見に行くことができます。
- ハルキさんのファン（購読者）が10,000人に増えました。でもMQTTなら、大丈夫。

WebScoketの場合は...

まとめるとMQTTは
- 送信側と受信側で接続を確立する必要がない
- 軽量なデータを頻繁に送るのに適している
- パブリッシャー（作家）とサブスクライバー（購読者）がたくさん増えても大丈夫。購読者は必要な情報だけ取りに行くことができる。


## 考えてみよう


### 1. 街中の太陽光発電システムの発電量をリアルタイムに取得し、本部で見られるようにする

回答 ※ 正解ということではなく、あくまでも1つの例です
電源: コンセントからとる

各家庭の太陽光発電システムをWi-Fiに接続し、取得した発電用をMQTTブローカーにパブリッシュする。
本部のPCで各家庭のデータをサブスクライブする。



### 2. キャッシュレス決済付きの自販機をつくるとき、どんな通信規格をつかう...？

回答 ※ 正解ということではなく、あくまでも1つの例です
- 電源: コンセントからとる
- ネットワーク: LTEかLPWA
決済時、スマートフォンでタッチ→ HTTPでペイメントシステムにリクエスト→ 決済が成功したレスポンスが返ってくる→ 飲み物が出る



# モノ（デバイス）について

今回使っているobniz以外にもたくさんの開発ボードがあります。
通信手段やサイズ、消費電力等の要件に応じてボードを選択します。


## Arduino UNO（アルドゥイーノ・ウノ）

写真

2005年にイタリアで5人の人物によって、「もっとシンプルに、もっと安価に、技術者でない学生でもデジタルなものを作ることができるようにする」というコンセプトで開発されたボードです。


単体ではUSB経由でのシリアル通信のみ、無線通信はできません。（Arduino Uno R3の場合。）

※つい最近（2023年）Arduino Uno R4 WiFitというWi-Fi・Bluetooth対応版商品が発売されました。



## RaspberryPi（ラズベリーパイ）

写真

カードサイズのシングルボードコンピュータ。2012年に最初のモデルが発売されました。
OSが搭載されていて、マウスやモニターを接続すればPCとしても使えます。

有線LANでの接続または、Wi-Fiモジュール内蔵または外付けでWi-Fiに接続できます。



## ESP32を搭載した開発ボード
ESP32は、Wi-FiとBluetoothを内蔵する低コスト/低消費電力なSoCのマイクロコントローラです。
ESP32モジュールが2016年に発売されて以降、**小さいのにたくさんの機能をもつ**ESP32系の開発ボードがたくさん誕生しました。


いくつか、人気のボードを紹介します。

### [M5Stack](https://shop.m5stack.com/collections/m5-controllers)

中国深圳に拠点を持つスタートアップ企業「M5Stack」社が作った開発ボードです。小さくてかわいい筐体の中にディスプレイ、ボタン、無線通信モジュールなど、必要な機能が詰め込まれています。

開発スピードが凄まじく、500円玉くらいのサイズのもの、電子ペーパーがついているもの、マイクが付いているものなどなど色々なタイプのボードがあります。
ファンも多く、新商品が出ると一瞬で売り切れます。



### obniz

みなさんが今使っているobnizの銀色の部分、よく見てみてください。

「ESP-WROOM-32」と書いてありますね。そうです、obnizもESP32を搭載した開発ボードの1つです！


obnizはIoTの敷居をグッッッと、下げてあらゆるひとがIoTの恩恵を受けられるということをビジョンに開発されたボードです。

配線やコーディングのハードルを取っ払い、はじめての人でもすぐに動かすことができます。

みなさんも、はじめてでもたったの1日でいくつものセンサーやアクチュエーターを動かし、インターネット経由でデータを送受信しましたね。




ちなみに...私のはじめての電子工作は大学の授業で、Arduinoを使ってLEDを光らせるだけで2コマ時間がかかりました。





